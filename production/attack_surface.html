<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Attack Surface - RISQIANT</title>
    <script type="module" src="/src/main-minimal-modern.js"></script>
  </head>

  <body class="nav-md page-index">
    <div class="container body">
      <div class="main_container">
        <!-- Sidebar & Top Nav (Standard Layout) -->
        <div class="col-md-3 left_col">
          <div class="left_col scroll-view">
            <div class="navbar nav_title" style="border: 0;">
              <a href="index.html" class="site_title"><img src="images/logo.svg" alt="RISQIANT" class="logo-full" style="height: 40px;"><img src="images/logo-icon.svg" alt="RISQIANT" class="logo-icon" style="height: 30px; display: none;"></a>
            </div>
            <div class="clearfix"></div>
            <div class="profile clearfix">
              <div class="profile_pic">
                <img src="images/img.jpg" alt="..." class="img-circle profile_img">
              </div>
              <div class="profile_info">
                <span>Welcome,</span>
                <h4>Admin User</h4>
              </div>
            </div>
            <br />
            <div id="sidebar-menu" class="main_menu_side hidden-print main_menu">
              <div class="menu_section">
                <h3>General</h3>
                <ul class="nav side-menu">
                  <li><a href="index.html"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                  <li><a><i class="fas fa-shield-alt"></i> Risk Assessment <span class="fas fa-chevron-down"></span></a>
                    <ul class="nav child_menu" style="display: block;">
                        <li class="current-page"><a href="attack_surface.html">Attack Surface</a></li>
                        <li><a href="vulnerabilities.html">Vulnerabilities</a></li>
                        <li><a href="risk_assessment.html">Risk Register</a></li>
                    </ul>
                  </li>
                  <li><a><i class="fas fa-check-circle"></i> Compliance <span class="fas fa-chevron-down"></span></a>
                    <ul class="nav child_menu">
                      <li><a href="compliance_soc2.html">SOC 2</a></li>
                      <li><a href="compliance_pci.html">PCI-DSS</a></li>
                      <li><a href="compliance_iso27001.html">ISO 27001</a></li>
                    </ul>
                  </li>
                  <li><a href="evidence_vault.html"><i class="fas fa-archive"></i> Evidence Library</a></li>
                  <li><a href="remediation.html"><i class="fas fa-lightbulb"></i> Remediation Center</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <div class="top_nav">
            <div class="nav_menu">
                <div class="nav toggle">
                  <a id="menu_toggle"><i class="fas fa-bars"></i></a>
                </div>
                <nav class="nav navbar-nav">
                <ul class="navbar-right">
                  <li class="nav-item dropdown open" style="padding-left: 15px;">
                    <a href="javascript:;" class="user-profile dropdown-toggle" aria-haspopup="true" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                      <img src="images/img.jpg" alt="">Admin User
                    </a>
                  </li>
                </ul>
              </nav>
            </div>
        </div>

        <!-- Page Content -->
        <div class="right_col" role="main">
          <div class="">
            <div class="page-title">
              <div class="title_left">
                <h3>Attack Surface Discovery</h3>
              </div>
            </div>

            <div class="clearfix"></div>

            <!-- Top Stats -->
            <div class="row">
              <div class="col-md-3 col-sm-6">
                <div class="tile-stats">
                  <div class="icon"><i class="fas fa-globe text-primary"></i></div>
                  <div class="count" id="stat-external-ips">0</div>
                  <h3>External IPs</h3>
                  <p>Publicly accessible addresses.</p>
                </div>
              </div>
              <div class="col-md-3 col-sm-6">
                <div class="tile-stats">
                  <div class="icon"><i class="fas fa-server text-success"></i></div>
                  <div class="count" id="stat-domains">0</div>
                  <h3>Domains</h3>
                  <p>Root and subdomains discovered.</p>
                </div>
              </div>
              <div class="col-md-3 col-sm-6">
                <div class="tile-stats">
                  <div class="icon"><i class="fas fa-door-open text-warning"></i></div>
                  <div class="count" id="stat-ports">0</div>
                  <h3>Open Ports</h3>
                  <p>Services listening on public interfaces.</p>
                </div>
              </div>
              <div class="col-md-3 col-sm-6">
                <div class="tile-stats">
                  <div class="icon"><i class="fas fa-box-open text-danger"></i></div>
                  <div class="count" id="stat-buckets">0</div>
                  <h3>Exposed Buckets</h3>
                  <p>Public cloud storage containers.</p>
                </div>
              </div>
            </div>

            <!-- Discovery Chart -->
            <div class="row">
              <div class="col-md-12 col-sm-12">
                <div class="x_panel">
                  <div class="x_title">
                    <h4>Asset Discovery Trend <small>Last 12 Months</small></h4>
                    <div class="clearfix"></div>
                  </div>
                  <div class="x_content">
                    <div id="chart_discovery" style="height: 350px;"></div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Asset Table -->
            <div class="row">
              <div class="col-md-12 col-sm-12">
                <div class="x_panel">
                  <div class="x_title">
                    <h4>Discovered External Assets</h4>
                    <div class="clearfix"></div>
                  </div>
                  <div class="x_content">
                    <table class="table table-striped">
                      <thead>
                        <tr>
                          <th>Asset Name</th>
                          <th>Type</th>
                          <th>IP Address</th>
                          <th>Discovery Date</th>
                          <th>Status</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>api.risqiant.com</td>
                          <td>Domain</td>
                          <td>203.0.113.45</td>
                          <td>2 days ago</td>
                          <td><span class="badge bg-success">Monitored</span></td>
                        </tr>
                        <tr>
                          <td>dev-db.aws.com</td>
                          <td>Cloud Instance</td>
                          <td>198.51.100.12</td>
                          <td>1 week ago</td>
                          <td><span class="badge bg-warning">Review</span></td>
                        </tr>
                        <tr>
                          <td>legacy-vpn.corp</td>
                          <td>Service</td>
                          <td>192.0.2.88</td>
                          <td>Today</td>
                          <td><span class="badge bg-danger">Exposed</span></td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>
        <!-- /page content -->

        <footer>
          <div class="float-end">RISQIANT - Security Operations</div>
          <div class="clearfix"></div>
        </footer>
      </div>
    </div>

    <!-- Logic -->
    <script type="module">
      import { mockData } from '/src/api/mockData.js';

      function initAttackSurface() {
        // Update Stats
        document.getElementById('stat-external-ips').textContent = mockData.assets.attackSurface.externalIPs;
        document.getElementById('stat-domains').textContent = mockData.assets.attackSurface.domains;
        document.getElementById('stat-ports').textContent = mockData.assets.attackSurface.openPorts;
        document.getElementById('stat-buckets').textContent = mockData.assets.attackSurface.exposedBuckets;

        // Initialize Chart
        initDiscoveryChart();
      }

      function initDiscoveryChart() {
        const container = document.getElementById('chart_discovery');
        if (!container) return;

        const canvas = document.createElement('canvas');
        canvas.width = container.offsetWidth;
        canvas.height = 350;
        container.innerHTML = '';
        container.appendChild(canvas);

        const ctx = canvas.getContext('2d');
        new Chart(ctx, {
          type: 'bar',
          data: {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
            datasets: [{
              label: 'New Assets Discovered',
              data: mockData.assets.attackSurface.discoveryTrend,
              backgroundColor: '#26B99A'
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: { y: { beginAtZero: true } }
          }
        });
      }

      document.addEventListener('DOMContentLoaded', () => {
        // Simple wait for Chart.js
        const check = setInterval(() => {
          if (typeof window.Chart !== 'undefined') {
            clearInterval(check);
            initAttackSurface();
          }
        }, 100);
      });
    </script>
  </body>
</html>
